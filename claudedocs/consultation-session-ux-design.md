# 클라이언트-전문가 상담 세션 UX/UI 연동 설계

## 📋 현재 시스템 분석

### 기존 구조
1. **클라이언트 상담 페이지** (`/expert-consultation`): 예약된 상담 목록 → 세션 시작
2. **전문가 세션 관리** (`/dashboard/expert/consultation-sessions`): 세션 목록 → 세션 관리
3. **실시간 세션룸** (`/sessions/[displayId]`): Agora 기반 화상/음성/채팅

### 현재 문제점
- 클라이언트와 전문가의 세션 진입 경험이 일관되지 않음
- 사전 준비(기기 테스트) 단계 부재
- 세션 상태 동기화 부족
- 모바일 대응 UI 일관성 부족

## 🎯 설계 목표

### 핵심 원칙
- **통합된 세션 진입 경험**: 클라이언트와 전문가 모두 동일한 고품질 UX
- **단계별 세션 상태**: 대기 → 준비 → 활성 → 완료
- **실시간 상태 동기화**: 양쪽 모두 실시간 상태 확인
- **모든 기기 최적화**: 데스크톱/태블릿/모바일 반응형

## 🔄 세션 플로우 설계

### 세션 상태 정의
```typescript
type SessionStatus =
  | 'SCHEDULED'    // 예약됨 (아직 입장 불가)
  | 'PRE_SESSION'  // 사전 준비 (5-10분 전부터)
  | 'WAITING_ROOM' // 대기실 (양쪽 입장 가능)
  | 'ACTIVE'       // 활성 세션 진행중
  | 'COMPLETED'    // 세션 완료
```

### 통합 진입 플로우
```
세션 목록 → 세션 카드 클릭 → 기기 준비 → 대기실 → 활성 세션
```

## 🎨 UI 컴포넌트 설계

### 1. 세션 카드 컴포넌트
```
┌─────────────────────────────────────┐
│ [프로필] 전문가/클라이언트명    [●] │ ← 상태 표시
│ 상담 주제                          │
│ 📅 9월 29일, 오후 2:00 (60분)     │
│ 💬/📞/📹 방식  │  💰 가격         │
│ ────────────────────────────────────│
│ [상태 뱃지] [액션 버튼]            │
└─────────────────────────────────────┘
```

**상태별 액션:**
- `SCHEDULED`: "곧 시작" (비활성)
- `PRE_SESSION`: "준비하기" (활성)
- `WAITING_ROOM`: "입장하기" (활성)
- `ACTIVE`: "참여중" (진행중 표시)

### 2. 사전 준비 모달
```
┌─────────────────────────────────────┐
│ 📋 세션 준비                        │
│                                     │
│ 🎥 카메라 테스트    [✓ 정상]       │
│ 🎤 마이크로폰      [✓ 정상]        │
│ 🌐 네트워크        [양호 - 25ms]   │
│ 🔊 스피커          [테스트]        │
│                                     │
│ 상대방 상태: [대기중...]            │
│                                     │
│ [취소] [준비 완료]                  │
└─────────────────────────────────────┘
```

**기능:**
- 카메라/마이크 권한 요청 및 테스트
- 네트워크 품질 체크 (RTT, 대역폭)
- 스피커 테스트 오디오 재생
- 상대방 준비 상태 실시간 표시

### 3. 대기실 인터페이스
```
┌─────────────────────────────────────┐
│ [이름]과의 상담                     │
│ 시작까지: 02:15                     │
│                                     │
│ 참가자:                             │
│ ✓ 나 (준비 완료)                   │
│ ⏳ 전문가명 (준비중...)             │
│                                     │
│ [카메라 프리뷰]                     │
│                                     │
│ [🎤][📹][⚙️] [나가기] [지금 시작]  │
└─────────────────────────────────────┘
```

**기능:**
- 실시간 참가자 상태 표시
- 카메라 프리뷰 및 기본 설정
- 카운트다운 타이머
- 조기 시작 옵션 (양쪽 준비 완료시)

### 4. 활성 세션 인터페이스 (통합)
```
┌─────────────────────────────────────────────────────────┐
│ ← [세션 정보] [⏱️ 25:30] [네트워크: 양호] [종료] [⚙️] │
├─────────────────────────────────────────────────────────┤
│                                                         │
│ ┌─ 메인 콘텐츠 영역 ─────────────────────┐ ┌─ 사이드 ─┐ │
│ │                                         │ │ 👤      │ │
│ │ 화상: 큰 비디오 + 작은 프리뷰           │ │ 참가자  │ │
│ │ 음성: 아바타 + 파형 애니메이션          │ │ (나)    │ │
│ │ 채팅: 전체 채팅 히스토리 + 입력창      │ │ 전문가  │ │
│ │                                         │ │         │ │
│ │                                         │ │ 💬📝    │ │
│ │                                         │ │ 채팅 &  │ │
│ │                                         │ │ 노트    │ │
│ └─────────────────────────────────────────┘ │ 탭      │ │
│                                               └─────────┘ │
│ ┌─ 컨트롤 ──────────────────────────────────────────────┐ │
│ │ [🎤] [📹] [🖥️] [💬] [📝] │ [녹화] [🎁] [❌종료] │ │
│ └─────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────┘
```

## 📱 반응형 레이아웃

### 데스크톱 (>1024px)
- 비디오 + 채팅/노트 나란히 배치
- 풍부한 컨트롤 옵션
- 화면 공유 지원

### 태블릿 (768px-1024px)
- 스택 레이아웃, 탭으로 전환
- 터치 최적화 컨트롤
- 간소화된 UI

### 모바일 (<768px)
- 전체화면 비디오
- 슬라이드업 컨트롤
- 최소화된 인터페이스

## 🔄 실시간 상태 동기화

### WebSocket/RTM 이벤트
```typescript
// 세션 이벤트
interface SessionEvents {
  participant_joined: { userId: string, role: 'client' | 'expert' };
  participant_ready: { userId: string, deviceStatus: DeviceStatus };
  session_started: { sessionId: string, timestamp: number };
  participant_left: { userId: string, reason: string };
  session_ended: { sessionId: string, duration: number };
  device_status_changed: { userId: string, device: string, status: boolean };
  network_quality_updated: { userId: string, quality: NetworkQuality };
}

// 공유 상태 객체
interface SessionState {
  sessionId: string;
  status: SessionStatus;
  participants: {
    client: ParticipantState;
    expert: ParticipantState;
  };
  timeRemaining: number;
  networkQuality: NetworkQuality;
  chatMessages: ChatMessage[];
}
```

### 상태 흐름
```
클라이언트 측              서버/RTM              전문가 측
    │                         │                       │
    ├─ join_session ─────────→│──── session_update ──→│
    │                         │                       │
    ├─ ready_status ─────────→│──── participant_ready ─→│
    │                         │                       │
    │←─ start_countdown ──────│←──── start_session ───┤
    │                         │                       │
    ├─ device_test_result ───→│──── device_status ───→│
```

## 🎭 전환 애니메이션 설계

### 1. 진입 전환 (목록 → 세션)
- 세션 카드에서 모달 오버레이 슬라이드
- 카드가 준비 인터페이스로 확장
- 기기 체크와 함께 로딩 상태
- 대기실로 부드러운 페이드

### 2. 대기실 → 활성 전환
- 카운트다운 애니메이션 (3-2-1-시작!)
- 비디오 프리뷰가 메인 영역으로 확장
- 하단에서 컨트롤 슬라이드업
- 참가자 상태 실시간 업데이트

### 3. 세션 종료 전환
- "세션 종료 중" 오버레이와 함께 부드러운 페이드
- 세션 노트 저장 프롬프트
- 감사 메시지 표시
- 업데이트된 상태로 목록 복귀

### 시각적 피드백 요소
- "다른 참가자 대기중"을 위한 펄스 점
- 네트워크 품질 표시기 (녹색/노랑/빨강)
- 명확한 아이콘으로 마이크/카메라 상태
- 채팅 타이핑 실시간 표시기
- 재시도 메커니즘을 포함한 연결 상태

## 🚀 구현 로드맵

### Phase 1: 핵심 세션 플로우 (1-2주차)
- **SessionState Context/Hook** 생성 (실시간 동기화용)
- **SessionCard** 컴포넌트 통합 디자인 구축
- **기기 테스트 유틸리티** 구현 (카메라/마이크/네트워크)
- **SessionPreparation** 모달 컴포넌트 생성

### Phase 2: 대기실 & 전환 (3주차)
- **WaitingRoom** 컴포넌트와 참가자 상태 구축
- **세션 카운트다운 타이머** 구현
- **상태 간 전환 애니메이션** 추가
- **SessionControls** 통합 컴포넌트 생성

### Phase 3: 활성 세션 인터페이스 (4-5주차)
- **일관성을 위한 세션룸 재설계**
- **반응형 레이아웃** 구현 (데스크톱/태블릿/모바일)
- **실시간 상태 표시기** 추가
- **채팅/노트 인터페이스** 향상

### Phase 4: 상태 관리 & 완성도 (6주차)
- **WebSocket/RTM 이벤트 처리** 구현
- **오류 처리 및 재시도 메커니즘** 추가
- **성능 최적화**
- **크로스 브라우저 테스팅 및 수정**

## 🛠 기술 요구사항

### 핵심 기술
- **Agora RTM**: 실시간 메시징
- **React Context**: 세션 상태 관리
- **Framer Motion**: 애니메이션
- **CSS Grid/Flexbox**: 반응형 디자인

### 새로운 컴포넌트
```typescript
// 핵심 컴포넌트
- SessionCard
- SessionPreparation
- WaitingRoom
- SessionControls
- DeviceTest
- NetworkQuality
- ParticipantStatus

// 훅
- useSessionState
- useDeviceTest
- useSessionTimer
- useNetworkQuality
```

## 📊 성공 지표

### UX 지표
- 세션 진입률 >95%
- 기술적 문제로 인한 이탈률 <5%
- 세션 완료율 >90%
- 사용자 만족도 >4.5/5

### 기술 지표
- 세션 시작 지연시간 <30초
- 네트워크 재연결 성공률 >95%
- 모바일 호환성 >98%
- 크로스 브라우저 호환성 >95%

---

이 설계는 클라이언트와 전문가 모두에게 예약된 세션에 원활하게 입장하여 고품질 화상/음성/채팅 상담을 진행할 수 있는 일관된 경험을 제공합니다.