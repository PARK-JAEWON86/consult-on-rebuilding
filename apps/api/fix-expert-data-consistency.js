const { PrismaClient } = require('@prisma/client');

const prisma = new PrismaClient();

async function fixExpertDataConsistency() {
  try {
    console.log('ðŸ”§ Fixing expert data consistency...');

    // ì „ë¬¸ë¶„ì•¼ë³„ë¡œ ë§¤ì¹­ë˜ëŠ” í•™ë ¥ê³¼ ê²½ë ¥ í…œí”Œë¦¿ ì •ì˜
    const expertProfiles = {
      'ì‹¬ë¦¬ìƒë‹´': {
        educations: [
          ["ê³ ë ¤ëŒ€í•™êµ ì‹¬ë¦¬í•™ í•™ì‚¬", "ì„œìš¸ëŒ€í•™êµ ìƒë‹´ì‹¬ë¦¬í•™ ì„ì‚¬"],
          ["ì¤‘ì•™ëŒ€í•™êµ ì‹¬ë¦¬í•™ í•™ì‚¬", "ì„œìš¸ëŒ€í•™êµ ìž„ìƒì‹¬ë¦¬í•™ ë°•ì‚¬"],
          ["ì—°ì„¸ëŒ€í•™êµ ì‹¬ë¦¬í•™ í•™ì‚¬", "ê³ ë ¤ëŒ€í•™êµ ìž„ìƒì‹¬ë¦¬í•™ ì„ì‚¬"],
          ["ì„œìš¸ëŒ€í•™êµ ì‹¬ë¦¬í•™ í•™ì‚¬", "ì—°ì„¸ëŒ€í•™êµ ìƒë‹´ì‹¬ë¦¬í•™ ì„ì‚¬"],
          ["ì´í™”ì—¬ìžëŒ€í•™êµ ì‹¬ë¦¬í•™ í•™ì‚¬", "ì„œìš¸ëŒ€í•™êµ ì‹¬ë¦¬í•™ ì„ì‚¬"]
        ],
        careers: [
          ["ì„œìš¸ì•„ì‚°ë³‘ì› ìž„ìƒì‹¬ë¦¬ì‚¬ (8ë…„)", "ê°œì¸ ì‹¬ë¦¬ìƒë‹´ì†Œ ìš´ì˜ (5ë…„)"],
          ["ì‚¼ì„±ì„œìš¸ë³‘ì› ìƒë‹´ì‹¬ë¦¬ì‚¬ (6ë…„)", "ì‹¬ë¦¬ìƒë‹´ì„¼í„° ì†Œìž¥ (4ë…„)"],
          ["êµ­ë¦½ì •ì‹ ê±´ê°•ì„¼í„° ìž„ìƒì‹¬ë¦¬ì‚¬ (7ë…„)", "í”„ë¦¬ëžœì„œ ì‹¬ë¦¬ìƒë‹´ì‚¬ (3ë…„)"],
          ["ì—°ì„¸ì„¸ë¸Œëž€ìŠ¤ë³‘ì› ì‹¬ë¦¬ì¹˜ë£Œì‚¬ (5ë…„)", "ëŒ€í•™ í•™ìƒìƒë‹´ì„¼í„° ìƒë‹´ì‚¬ (6ë…„)"],
          ["ì„œìš¸ëŒ€ë³‘ì› ì •ì‹ ê±´ê°•ì˜í•™ê³¼ ì‹¬ë¦¬ì‚¬ (9ë…„)", "ê°œì¸ ì‹¬ë¦¬í´ë¦¬ë‹‰ ìš´ì˜ (2ë…„)"]
        ]
      },
      'ë²•ë¥ ìƒë‹´': {
        educations: [
          ["ì„±ê· ê´€ëŒ€í•™êµ ë²•í•™ í•™ì‚¬", "ì„œìš¸ëŒ€í•™êµ ë²•í•™ ì„ì‚¬"],
          ["ì„œìš¸ëŒ€í•™êµ ë²•í•™ í•™ì‚¬", "ê³ ë ¤ëŒ€í•™êµ ë²•í•™ ì„ì‚¬"],
          ["ì—°ì„¸ëŒ€í•™êµ ë²•í•™ í•™ì‚¬", "ì„œìš¸ëŒ€í•™êµ ë²•í•™ ë°•ì‚¬"],
          ["ê³ ë ¤ëŒ€í•™êµ ë²•í•™ í•™ì‚¬", "ì„±ê· ê´€ëŒ€í•™êµ ë²•í•™ ì„ì‚¬"],
          ["í•œì–‘ëŒ€í•™êµ ë²•í•™ í•™ì‚¬", "ì—°ì„¸ëŒ€í•™êµ ë²•í•™ ì„ì‚¬"]
        ],
        careers: [
          ["ë²•ë¬´ë²•ì¸ ê¹€ì•¤ìž¥ ë³€í˜¸ì‚¬ (10ë…„)", "ê¸°ì—… ë²•ë¬´íŒ€ ë²•ë¬´ì´ì‚¬ (5ë…„)"],
          ["ë²•ë¬´ë²•ì¸ íƒœí‰ì–‘ ë³€í˜¸ì‚¬ (8ë…„)", "ê°œì¸ ë¡œíŽŒ ëŒ€í‘œë³€í˜¸ì‚¬ (7ë…„)"],
          ["ëŒ€ë²•ì› ìž¬íŒì—°êµ¬ê´€ (4ë…„)", "ë²•ë¬´ë²•ì¸ ê´‘ìž¥ íŒŒíŠ¸ë„ˆ ë³€í˜¸ì‚¬ (9ë…„)"],
          ["ê²€ì°°ì²­ ê²€ì‚¬ (6ë…„)", "ë²•ë¬´ë²•ì¸ ì„¸ì¢… ì‹œë‹ˆì–´ ë³€í˜¸ì‚¬ (8ë…„)"],
          ["ë²•ë¬´ë¶€ ë²•ë¬´ê´€ (5ë…„)", "ê¸°ì—… ì¤€ë²•ê°ì‹œì¸ (6ë…„)"]
        ]
      },
      'ìž¬ë¬´ìƒë‹´': {
        educations: [
          ["ì„œìš¸ëŒ€í•™êµ ê²½ì˜í•™ í•™ì‚¬", "ì—°ì„¸ëŒ€í•™êµ ê²½ì˜í•™ ì„ì‚¬ (MBA)"],
          ["ì—°ì„¸ëŒ€í•™êµ ê²½ì œí•™ í•™ì‚¬", "ì„œìš¸ëŒ€í•™êµ ê²½ì˜í•™ ì„ì‚¬"],
          ["ê³ ë ¤ëŒ€í•™êµ ê²½ì˜í•™ í•™ì‚¬", "Wharton School MBA"],
          ["ì„œìš¸ì‹œë¦½ëŒ€í•™êµ ì„¸ë¬´í•™ í•™ì‚¬", "ê³ ë ¤ëŒ€í•™êµ ê²½ì˜í•™ ì„ì‚¬"],
          ["ì„±ê· ê´€ëŒ€í•™êµ ê²½ì˜í•™ í•™ì‚¬", "Chicago Booth MBA"]
        ],
        careers: [
          ["ì‚¼ì„±ì¦ê¶Œ ë¦¬ì„œì¹˜ì„¼í„° ì• ë„ë¦¬ìŠ¤íŠ¸ (6ë…„)", "ìžì‚°ìš´ìš©ì‚¬ í¬íŠ¸í´ë¦¬ì˜¤ ë§¤ë‹ˆì € (4ë…„)"],
          ["ê³¨ë“œë§Œì‚­ìŠ¤ íˆ¬ìžì€í–‰ VP (7ë…„)", "ì‚¬ëª¨íŽ€ë“œ íˆ¬ìžì‹¬ì‚¬ì—­ (3ë…„)"],
          ["JPëª¨ê±´ íˆ¬ìžì€í–‰ MD (9ë…„)", "í—¤ì§€íŽ€ë“œ íŽ€ë“œë§¤ë‹ˆì € (4ë…„)"],
          ["í•œêµ­ì€í–‰ ê¸ˆìœµí†µí™”ìœ„ì›íšŒ (5ë…„)", "ì¦ê¶Œì‚¬ ë¦¬ì„œì¹˜ì„¼í„°ìž¥ (8ë…„)"],
          ["ê¸°ì—…ì€í–‰ ê¸°ì—…ê¸ˆìœµë¶€ (7ë…„)", "ìž¬ë¬´ ì»¨ì„¤íŒ…íŽŒ íŒŒíŠ¸ë„ˆ (6ë…„)"]
        ]
      },
      'ê±´ê°•ìƒë‹´': {
        educations: [
          ["ì„œìš¸ëŒ€í•™êµ ì˜í•™ í•™ì‚¬", "ì„œìš¸ëŒ€í•™êµ ë³´ê±´í•™ ì„ì‚¬"],
          ["ì—°ì„¸ëŒ€í•™êµ ê°„í˜¸í•™ í•™ì‚¬", "ì„œìš¸ëŒ€í•™êµ ë³´ê±´í•™ ì„ì‚¬"],
          ["ê°€í†¨ë¦­ëŒ€í•™êµ ì˜í•™ í•™ì‚¬", "ì—°ì„¸ëŒ€í•™êµ ë³´ê±´í•™ ì„ì‚¬"],
          ["ì´í™”ì—¬ìžëŒ€í•™êµ ì‹í’ˆì˜ì–‘í•™ í•™ì‚¬", "ì„œìš¸ëŒ€í•™êµ ë³´ê±´í•™ ì„ì‚¬"],
          ["ê³ ë ¤ëŒ€í•™êµ ìƒëª…ê³¼í•™ í•™ì‚¬", "ì—°ì„¸ëŒ€í•™êµ ì˜í•™ ì„ì‚¬"]
        ],
        careers: [
          ["ì„œìš¸ëŒ€ë³‘ì› ê°€ì •ì˜í•™ê³¼ ì „ë¬¸ì˜ (10ë…„)", "ê±´ê°•ê²€ì§„ì„¼í„° ì›ìž¥ (5ë…„)"],
          ["ì‚¼ì„±ì„œìš¸ë³‘ì› ë‚´ê³¼ ì „ë¬¸ì˜ (8ë…„)", "ì¢…í•©ë³‘ì› ê±´ê°•ì¦ì§„ì„¼í„° ì†Œìž¥ (4ë…„)"],
          ["ì„¸ë¸Œëž€ìŠ¤ë³‘ì› ì˜ì–‘ì‚¬ (7ë…„)", "ê°œì¸ ì˜ì–‘ìƒë‹´ì†Œ ìš´ì˜ (6ë…„)"],
          ["ì•„ì‚°ë³‘ì› ê°„í˜¸ì‚¬ (6ë…„)", "ê¸°ì—… ì‚°ì—…ë³´ê±´ ê´€ë¦¬ìž (5ë…„)"],
          ["êµ­ë¦½ì•”ì„¼í„° ì—°êµ¬ì› (5ë…„)", "í—¬ìŠ¤ì¼€ì–´ ìŠ¤íƒ€íŠ¸ì—… CMO (4ë…„)"]
        ]
      },
      'ì§„ë¡œìƒë‹´': {
        educations: [
          ["ì„œìš¸ëŒ€í•™êµ êµìœ¡í•™ í•™ì‚¬", "ì—°ì„¸ëŒ€í•™êµ ìƒë‹´ì‹¬ë¦¬í•™ ì„ì‚¬"],
          ["ì—°ì„¸ëŒ€í•™êµ ì‹¬ë¦¬í•™ í•™ì‚¬", "ì„œìš¸ëŒ€í•™êµ êµìœ¡í•™ ì„ì‚¬"],
          ["ì´í™”ì—¬ìžëŒ€í•™êµ êµìœ¡í•™ í•™ì‚¬", "ê³ ë ¤ëŒ€í•™êµ ì§„ë¡œìƒë‹´í•™ ì„ì‚¬"],
          ["ê³ ë ¤ëŒ€í•™êµ ì‚¬íšŒí•™ í•™ì‚¬", "ì„œìš¸ëŒ€í•™êµ êµìœ¡í•™ ì„ì‚¬"],
          ["ì„±ê· ê´€ëŒ€í•™êµ êµìœ¡í•™ í•™ì‚¬", "ì—°ì„¸ëŒ€í•™êµ ì§„ë¡œìƒë‹´í•™ ì„ì‚¬"]
        ],
        careers: [
          ["êµìœ¡ë¶€ ì§„ë¡œì •ì±…ê³¼ ì‚¬ë¬´ê´€ (8ë…„)", "ëŒ€í•™ ì§„ë¡œê°œë°œì„¼í„° ì„¼í„°ìž¥ (5ë…„)"],
          ["í•œêµ­ê³ ìš©ì •ë³´ì› ì—°êµ¬ìœ„ì› (7ë…„)", "ì§„ë¡œìƒë‹´ì„¼í„° ì†Œìž¥ (6ë…„)"],
          ["ëŒ€ê¸°ì—… ì¸ì‚¬íŒ€ ë¶€ìž¥ (10ë…„)", "í—¤ë“œí—ŒíŒ… íšŒì‚¬ ëŒ€í‘œ (4ë…„)"],
          ["ê³µê³µê¸°ê´€ ì±„ìš©ë‹´ë‹¹ (6ë…„)", "ì§„ë¡œìƒë‹´ ì „ë¬¸ê¸°ê´€ ì‹¤ìž¥ (7ë…„)"],
          ["ëŒ€í•™êµ í•™ìƒì²˜ ì²˜ìž¥ (9ë…„)", "ê°œì¸ ì§„ë¡œìƒë‹´ì†Œ ìš´ì˜ (3ë…„)"]
        ]
      }
    };

    const experts = await prisma.expert.findMany({
      where: { isActive: true },
      select: {
        id: true,
        name: true,
        specialty: true,
      }
    });

    console.log(`ðŸ“Š Found ${experts.length} active experts to update`);

    let updateCount = 0;

    for (const expert of experts) {
      const specialty = expert.specialty;
      const profiles = expertProfiles[specialty];

      if (!profiles) {
        console.log(`âš ï¸  No profile template for specialty: ${specialty}`);
        continue;
      }

      // ì „ë¬¸ê°€ IDë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì¼ê´€ëœ êµìœ¡ê³¼ ê²½ë ¥ ì„ íƒ
      const educationIndex = expert.id % profiles.educations.length;
      const careerIndex = expert.id % profiles.careers.length;

      const selectedEducation = profiles.educations[educationIndex];
      const selectedCareer = profiles.careers[careerIndex];

      console.log(`\nðŸ”§ Updating ${expert.name} (${specialty}):`);
      console.log(`   ðŸŽ“ New Education: ${selectedEducation.join(', ')}`);
      console.log(`   ðŸ’¼ New Career: ${selectedCareer.join(', ')}`);

      try {
        await prisma.expert.update({
          where: { id: expert.id },
          data: {
            education: selectedEducation,
            portfolioItems: selectedCareer
          }
        });
        updateCount++;
        console.log(`   âœ… Successfully updated`);
      } catch (error) {
        console.error(`   âŒ Failed to update: ${error.message}`);
      }
    }

    console.log(`\nðŸŽ‰ Expert data consistency fix completed!`);
    console.log(`ðŸ“Š Total experts updated: ${updateCount}`);

  } catch (error) {
    console.error('âŒ Error during fix:', error);
  } finally {
    await prisma.$disconnect();
  }
}

// ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰
if (require.main === module) {
  fixExpertDataConsistency()
    .then(() => {
      console.log('\nâœ¨ Expert data consistency fix completed successfully!');
      process.exit(0);
    })
    .catch((error) => {
      console.error('\nðŸ’¥ Expert data consistency fix failed:', error);
      process.exit(1);
    });
}

module.exports = { fixExpertDataConsistency };