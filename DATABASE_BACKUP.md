# ë°ì´í„°ë² ì´ìŠ¤ ë°±ì—… ë° ë³µì› ê°€ì´ë“œ

## ğŸ“¦ ë°±ì—…

### ìë™ ë°±ì—… ì‹¤í–‰

```bash
./backup-database.sh
```

### ë°±ì—… ë‚´ìš©

- **ë°ì´í„°ë² ì´ìŠ¤**: consulton_dev
- **í¬í•¨ í•­ëª©**:
  - ëª¨ë“  í…Œì´ë¸” ë°ì´í„°
  - ìŠ¤í‚¤ë§ˆ êµ¬ì¡°
  - íŠ¸ë¦¬ê±°, í”„ë¡œì‹œì €, ì´ë²¤íŠ¸
  - Foreign Key ê´€ê³„

### ë°±ì—… íŒŒì¼ ìœ„ì¹˜

```
database/backups/consulton_backup_YYYYMMDD_HHMMSS.sql.gz
```

ì˜ˆì‹œ:
```
database/backups/consulton_backup_20250930_170022.sql.gz
```

### ë°±ì—… ê´€ë¦¬

- ìë™ìœ¼ë¡œ ìµœê·¼ 5ê°œ ë°±ì—…ë§Œ ìœ ì§€
- ì˜¤ë˜ëœ ë°±ì—…ì€ ìë™ ì‚­ì œ
- Gzip ì••ì¶•ìœ¼ë¡œ ìš©ëŸ‰ ì ˆì•½ (ì•½ 80% ì••ì¶•)

### ë°±ì—… ì˜ˆì‹œ

```bash
$ ./backup-database.sh

==============================================================
  ë°ì´í„°ë² ì´ìŠ¤ ë°±ì—… ì‹œì‘
==============================================================

ğŸ“Š ë°±ì—… ì •ë³´:
   ë°ì´í„°ë² ì´ìŠ¤: consulton_dev
   í˜¸ìŠ¤íŠ¸: localhost:3306
   ë°±ì—… íŒŒì¼: ./database/backups/consulton_backup_20250930_170022.sql

â³ ë°±ì—… ì§„í–‰ ì¤‘...
âœ… ë°±ì—… ì™„ë£Œ!
   íŒŒì¼ í¬ê¸°: 532K

ğŸ—œï¸  ì••ì¶• ì§„í–‰ ì¤‘...
âœ… ì••ì¶• ì™„ë£Œ!
   ì••ì¶• íŒŒì¼: ./database/backups/consulton_backup_20250930_170022.sql.gz
   ì••ì¶• í¬ê¸°: 108K

âœ… ë°±ì—… ì„±ê³µ!
```

---

## ğŸ”„ ë³µì›

### ë³µì› ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰

```bash
./restore-database.sh
```

### ë³µì› í”„ë¡œì„¸ìŠ¤

1. ì‚¬ìš© ê°€ëŠ¥í•œ ë°±ì—… íŒŒì¼ ëª©ë¡ í‘œì‹œ
2. ë³µì›í•  ë°±ì—… ì„ íƒ
3. í™•ì¸ ë©”ì‹œì§€ (yes ì…ë ¥ í•„ìš”)
4. ë°ì´í„°ë² ì´ìŠ¤ ë³µì›
5. ë³µì› ê²°ê³¼ í™•ì¸

### ë³µì› ì˜ˆì‹œ

```bash
$ ./restore-database.sh

==============================================================
  ë°ì´í„°ë² ì´ìŠ¤ ë³µì›
==============================================================

ğŸ“‹ ì‚¬ìš© ê°€ëŠ¥í•œ ë°±ì—… íŒŒì¼:

   [1] 2025-09-30 17:00:22 - 108K
   [2] 2025-09-29 15:30:15 - 105K
   [3] 2025-09-28 10:20:45 - 102K

ë³µì›í•  ë°±ì—… ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš” (ê¸°ë³¸ê°’: 1 - ìµœì‹  ë°±ì—…):
ì„ íƒ: 1

ì„ íƒëœ ë°±ì—…: consulton_backup_20250930_170022.sql.gz

âš ï¸  ê²½ê³ : í˜„ì¬ ë°ì´í„°ë² ì´ìŠ¤ì˜ ëª¨ë“  ë°ì´í„°ê°€ ì‚­ì œë˜ê³  ë°±ì—…ìœ¼ë¡œ ë³µì›ë©ë‹ˆë‹¤!
ê³„ì†í•˜ì‹œê² ìŠµë‹ˆê¹Œ? (yes/no):
> yes

==============================================================
  ë³µì› ì‹œì‘
==============================================================

ğŸ“¦ ì••ì¶• í•´ì œ ì¤‘...
âœ… ì••ì¶• í•´ì œ ì™„ë£Œ

â³ ë°ì´í„°ë² ì´ìŠ¤ ë³µì› ì¤‘...
âœ… ë³µì› ì™„ë£Œ!

ğŸ“Š ë°ì´í„°ë² ì´ìŠ¤ ìƒíƒœ í™•ì¸ ì¤‘...
âœ… í…Œì´ë¸” ê°œìˆ˜: 22

ğŸ‰ ë³µì› ì™„ë£Œ!
```

### íŠ¹ì • ë°±ì—… ë³µì›

```bash
# ë‘ ë²ˆì§¸ ë°±ì—… ë³µì›
./restore-database.sh 2

# ì„¸ ë²ˆì§¸ ë°±ì—… ë³µì›
./restore-database.sh 3
```

---

## âš ï¸ ì£¼ì˜ì‚¬í•­

### ë°±ì—… ì „

1. **MySQL ì„œë²„ ì‹¤í–‰ í™•ì¸**
   ```bash
   mysql.server status
   ```

2. **ë””ìŠ¤í¬ ê³µê°„ í™•ì¸**
   ```bash
   df -h
   ```

3. **ë°ì´í„°ë² ì´ìŠ¤ ì ‘ì† í™•ì¸**
   ```bash
   mysql -u consulton -p consulton_dev
   ```

### ë³µì› ì „

1. **âš ï¸ ë³µì›ì€ í˜„ì¬ ë°ì´í„°ë¥¼ ì™„ì „íˆ ì‚­ì œí•©ë‹ˆë‹¤!**
2. ë³µì› ì „ ë°˜ë“œì‹œ í˜„ì¬ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ë°±ì—…í•˜ì„¸ìš”
3. ë³µì›í•  ë°±ì—… íŒŒì¼ì´ ì •í™•í•œì§€ í™•ì¸í•˜ì„¸ìš”
4. í”„ë¡œë•ì…˜ í™˜ê²½ì—ì„œëŠ” ë”ìš± ì‹ ì¤‘í•˜ê²Œ!

---

## ğŸ”§ ìˆ˜ë™ ë°±ì—…/ë³µì›

### ìˆ˜ë™ ë°±ì—…

```bash
mysqldump \
  --host=localhost \
  --port=3306 \
  --user=consulton \
  --password=password \
  --databases consulton_dev \
  --single-transaction \
  --routines \
  --triggers \
  --events \
  > backup.sql

# ì••ì¶•
gzip backup.sql
```

### ìˆ˜ë™ ë³µì›

```bash
# ì••ì¶• í•´ì œ
gunzip backup.sql.gz

# ë³µì›
mysql \
  --host=localhost \
  --port=3306 \
  --user=consulton \
  --password=password \
  < backup.sql
```

---

## ğŸ“Š ë°±ì—… ìŠ¤ì¼€ì¤„ë§ (ì„ íƒì‚¬í•­)

### Cronìœ¼ë¡œ ìë™ ë°±ì—… ì„¤ì •

```bash
# crontab í¸ì§‘
crontab -e

# ë§¤ì¼ ì˜¤ì „ 3ì‹œì— ë°±ì—…
0 3 * * * cd /Users/jaewon/project/Consutl-On-re && ./backup-database.sh >> /tmp/db-backup.log 2>&1

# ë§¤ì£¼ ì¼ìš”ì¼ ì˜¤ì „ 2ì‹œì— ë°±ì—…
0 2 * * 0 cd /Users/jaewon/project/Consutl-On-re && ./backup-database.sh >> /tmp/db-backup.log 2>&1
```

---

## ğŸ› ë¬¸ì œ í•´ê²°

### ë°±ì—… ì‹¤íŒ¨

**ì—ëŸ¬**: `mysqldump: command not found`
```bash
# mysqldump ê²½ë¡œ í™•ì¸
which mysqldump

# ìŠ¤í¬ë¦½íŠ¸ì˜ mysqldump ê²½ë¡œ ìˆ˜ì •
# /usr/local/mysql/bin/mysqldump
```

**ì—ëŸ¬**: `Access denied for user`
```bash
# .env íŒŒì¼ì˜ DATABASE_URL í™•ì¸
cat .env | grep DATABASE_URL

# ë¹„ë°€ë²ˆí˜¸ í™•ì¸
mysql -u consulton -p
```

**ì—ëŸ¬**: `Can't connect to MySQL server`
```bash
# MySQL ì„œë²„ ì‹œì‘
mysql.server start

# ìƒíƒœ í™•ì¸
mysql.server status
```

### ë³µì› ì‹¤íŒ¨

**ì—ëŸ¬**: `Unknown database`
```bash
# ë°ì´í„°ë² ì´ìŠ¤ ìƒì„±
mysql -u consulton -p -e "CREATE DATABASE IF NOT EXISTS consulton_dev;"
```

**ì—ëŸ¬**: `Disk full`
```bash
# ë””ìŠ¤í¬ ê³µê°„ í™•ì¸
df -h

# ì˜¤ë˜ëœ ë°±ì—… ìˆ˜ë™ ì‚­ì œ
rm database/backups/consulton_backup_20250101_*.sql.gz
```

---

## ğŸ“ ë°±ì—… íŒŒì¼ ì •ë³´

### íŒŒì¼ êµ¬ì¡°

```
database/backups/
â”œâ”€â”€ consulton_backup_20250930_170022.sql.gz  (ìµœì‹ )
â”œâ”€â”€ consulton_backup_20250929_153015.sql.gz
â”œâ”€â”€ consulton_backup_20250928_102045.sql.gz
â”œâ”€â”€ consulton_backup_20250927_093030.sql.gz
â””â”€â”€ consulton_backup_20250926_081520.sql.gz  (ê°€ì¥ ì˜¤ë˜ë¨)
```

### ë°±ì—… íŒŒì¼ ë‚´ìš©

- DROP DATABASE ë° CREATE DATABASE ë¬¸
- CREATE TABLE ë¬¸
- INSERT INTO ë¬¸ (ëª¨ë“  ë°ì´í„°)
- CREATE TRIGGER ë¬¸
- CREATE PROCEDURE/FUNCTION ë¬¸
- CREATE EVENT ë¬¸

---

## âœ… ê¶Œì¥ ì‚¬í•­

1. **ì •ê¸°ì ì¸ ë°±ì—…**
   - ê°œë°œ í™˜ê²½: ë§¤ì¼ ë˜ëŠ” ì£¼ìš” ì‘ì—… ì „
   - ìŠ¤í…Œì´ì§• í™˜ê²½: ë§¤ì¼
   - í”„ë¡œë•ì…˜ í™˜ê²½: ë§¤ì¼ + ë°°í¬ ì „

2. **ë°±ì—… í…ŒìŠ¤íŠ¸**
   - ì›” 1íšŒ ë³µì› í…ŒìŠ¤íŠ¸ ìˆ˜í–‰
   - ë°±ì—… íŒŒì¼ ë¬´ê²°ì„± í™•ì¸

3. **ë°±ì—… ì €ì¥**
   - ë¡œì»¬ ë°±ì—…: ìµœê·¼ 5ê°œ
   - ì™¸ë¶€ ì €ì¥ì†Œ: í´ë¼ìš°ë“œ ìŠ¤í† ë¦¬ì§€ì— ì¶”ê°€ ë°±ì—…

4. **ë¬¸ì„œí™”**
   - ë°±ì—…/ë³µì› ì ˆì°¨ ìˆ™ì§€
   - íŒ€ì›ë“¤ê³¼ ê³µìœ 

---

## ğŸ“ ë¬¸ì˜

ë°±ì—…/ë³µì› ê´€ë ¨ ë¬¸ì œê°€ ë°œìƒí•˜ë©´:

1. ì´ ë¬¸ì„œì˜ "ë¬¸ì œ í•´ê²°" ì„¹ì…˜ ì°¸ì¡°
2. MySQL ë¡œê·¸ í™•ì¸: `/usr/local/mysql/data/*.err`
3. ìŠ¤í¬ë¦½íŠ¸ ë¡œê·¸ í™•ì¸